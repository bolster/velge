!function(){window.Velge=function(){function a(b,c){null==c&&(c={}),this.store=new a.Store,this.ui=new a.UI(b,this,this.store),this._preloadChoices(c.chosen||[],!0),this._preloadChoices(c.choices||[],!1)}return a.prototype.setup=function(){return this.ui.setup(),this},a.prototype.addChosen=function(a){return this.store.push(a,!0),this.ui.renderChosen(),this},a.prototype.addChoice=function(a){return this.store.push(a),this.ui.renderChoices(),this},a.prototype.remChoice=function(a){return this.store["delete"](a),this.ui.renderChoices(),this},a.prototype.remChosen=function(a){return this.store.update(a,{chosen:!1}),this.ui.renderChosen(),this.ui.renderChoices(),this},a.prototype._preloadChoices=function(a,b){var c,d,e,f;for(f=[],d=0,e=a.length;e>d;d++)c=a[d],f.push(this.store.push(c,b));return f},a}(),Velge.UI=function(){function a(a,b,c){this.$container=a,this.velge=b,this.store=c}return a.prototype.KEYCODES={TAB:9,ENTER:13,ESCAPE:27,LEFT:37,UP:38,RIGHT:39,DOWN:40,COMMA:188},a.prototype.wrapTemplate="<div class='velge'>\n  <ul class='velge-list'></ul>\n  <input type='text' autocomplete='off' placeholder='Add Tags' class='velge-input placeholder' />\n  <span class='velge-trigger'></span>\n  <ol class='velge-dropdown'></ol>\n</div>",a.prototype.chosenTemplate="<li>\n  <b>{{name}}</b>\n  <i>&times;</i>\n</li>",a.prototype.choiceTemplate="<li>{{name}}</li>",a.prototype.setup=function(){return this.render(),this.bindDomEvents(),this.renderChoices(),this.renderChosen(),this},a.prototype.bindDomEvents=function(){var a,b;return a=this.KEYCODES,b=this,this.$wrapper.on("keydown.velge",".velge-input",function(c){switch(c.which){case a.ESCAPE:return b.closeDropdown(),b.$input.val("");case a.DOWN:return b.openDropdown(),b.store.cycle("down"),b.renderHighlighted();case a.UP:return b.openDropdown(),b.store.cycle("up"),b.renderHighlighted()}}),this.$wrapper.on("blur.velge",".velge-input",function(){var a;return clearTimeout(b.closeTimeout),a=function(){return b.closeDropdown(),b.blurInput()},b.closeTimeout=setTimeout(a,75)}),this.$wrapper.on("click.velge",".velge-trigger",function(){return b.openDropdown()}),this.$wrapper.on("click.velge",".velge-dropdown li",function(a){var c;return c=$(a.currentTarget),b.choose(c.text()),b.renderChoices(),b.renderChosen(),b.closeDropdown()})},a.prototype.choose=function(a){return this.store.update({name:a},{chosen:!0})},a.prototype.render=function(){return this.$wrapper=$(this.wrapTemplate),this.$list=$(".velge-list",this.$wrapper),this.$input=$(".velge-input",this.$wrapper),this.$dropdown=$(".velge-dropdown",this.$wrapper),this.$container.append(this.$wrapper)},a.prototype.renderChosen=function(){var a,b;return b=function(){var b,c,d,e;for(d=this.store.filter(!0),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.chosenTemplate.replace("{{name}}",a.name));return e}.call(this),this.$list.empty().html(b)},a.prototype.renderChoices=function(){var a,b;return b=function(){var b,c,d,e;for(d=this.store.filter(!1),e=[],b=0,c=d.length;c>b;b++)a=d[b],e.push(this.choiceTemplate.replace("{{name}}",a.name));return e}.call(this),this.$dropdown.empty().html(b)},a.prototype.renderHighlighted=function(){var a,b,c,d,e,f,g;for(c=this.store.index,f=this.$dropdown.find("li"),g=[],a=d=0,e=f.length;e>d;a=++d)b=f[a],g.push($(b).toggleClass("highlighted",a===c));return g},a.prototype.openDropdown=function(){return this.store.isEmpty()?void 0:this.$dropdown.addClass("open")},a.prototype.closeDropdown=function(){return this.$dropdown.removeClass("open")},a.prototype.blurInput=function(){return this.$input.blur()},a}(),Velge.Store=function(){function a(){this.arr=[],this.map={},this.index=-1}return a.prototype.objects=function(){return this.arr},a.prototype.normalize=function(a){return String(a).toLowerCase().replace(/(^\s*|\s*$)/g,"")},a.prototype.push=function(a,b){return null==b&&(b=!1),a.chosen=b,a.name=this.normalize(a.name),null==this.find(a)&&(this.arr.push(a),this.map[a.name]=a),this.sort(),this},a.prototype["delete"]=function(a){var b,c,d,e,f;for(f=this.arr,c=d=0,e=f.length;e>d;c=++d)if(b=f[c],b.name===a.name){this.arr.splice(c,1);break}return delete this.map[a.name],this},a.prototype.update=function(a,b){var c,d,e,f;c=this.find(a),f=[];for(d in b)e=b[d],f.push(c[d]=e);return f},a.prototype.length=function(a){return null==a&&(a=!1),a?this.arr.length:this.filter(a).length},a.prototype.cycle=function(a){var b;return null==a&&(a="down"),b=this.length(),this.index="down"===a?(this.index+1)%b:(this.index+(b-1))%b},a.prototype.selected=function(){return this.filter(!1)[this.index]},a.prototype.filter=function(a){var b,c,d,e,f;for(e=this.arr,f=[],c=0,d=e.length;d>c;c++)b=e[c],b.chosen===a&&f.push(b);return f},a.prototype.find=function(a){return this.map[a.name]},a.prototype.isEmpty=function(){return 0===this.arr.length},a.prototype.sort=function(){return this.arr=this.arr.sort(function(a,b){return a.name>b.name?1:-1}),this.arr},a}()}.call(this);